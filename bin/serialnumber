#!/bin/bash
if [ -f /etc/environment.local ]; then
        . /etc/environment.local
fi
if [[ -z $NINJA_HARDWARE_TYPE ]]; then
        . /opt/utilities/bin/detect-hw-os
        . /etc/environment.local
fi
if [[ -n $NINJA_HARDWARE_TYPE ]]; then
        if [ "$NINJA_HARDWARE_TYPE" == "BBW" ]; then
		        serial=`sudo xxd -g 2 -a -l 16 -seek 16 /sys/bus/i2c//devices/1-0050/eeprom | sed 's/^.* //' | sed -e 's/[.]//g'`
		        echo $serial > /etc/opt/ninja/serial.conf
        elif [ "$NINJA_HARDWARE_TYPE" == "BBB" ]; then
                capemgr=/sys/devices/bone_capemgr.9
                if [ ! -d $capemgr ] ; then
                        capemgr=/sys/devices/platform/bone_capemgr
                fi
                cat $capemgr/baseboard/serial-number > /etc/opt/ninja/serial.conf
        fi
fi
if [ -f /etc/opt/ninja/serial.override.conf ]; then
	cat /etc/opt/ninja/serial.override.conf > /etc/opt/ninja/serial.conf
fi
